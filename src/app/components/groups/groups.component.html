<div class="container font-Barlow">
    <div id="header"
        class="flex items-center justify-center self-stretch min-h-[48px] bg-secondaryBg px-[15px] gap-[15px] border-y border-solid border-custom-border">
        <span class="text-xs leading-[18px] font-bold text-secondary-heiglight w-full">
            <input matInput placeholder="Groups" (keyup)="onKeyPress($event)"
                class="outline-none bg-secondaryBg w-full placeholder:text-secondary-heiglight text-secondary-heiglight text-xs leading-[18px] font-bold" />
        </span>
        <span class="text-yellow text-xs min-w-[90px] font-bold leading-[18px] cursor-pointer" (click)="addGroup('addGroup','')">+ Add new group</span>
        <div class="flex items-center">
            <span class="px-[15px] py-[5px] cursor-pointer bg-primaryBg rounded-[50px] min-w-[44px] !h-[24px] flex justify-center items-center gap-[10px] self-stretch">
                <img src="assets/svg-icons/search-icon.svg" class="w-[14px] h-[14px]" />
            </span>
        </div>
        <!-- <div class="flex items-center">
            <span class="px-[15px] py-[5px] bg-primaryBg cursor-pointer rounded-[50px] min-w-[44px] !h-[24px] flex justify-center items-center gap-[10px] self-stretch">
                <img src="assets/svg-icons/filter-icon.svg" class="w-[14px] h-[14px]" />
            </span>
        </div> -->
        
        <span class="w-[16px] !min-w-[16px] !min-h-[14px] h-[14px] cursor-pointer" (click)="closeLibraryDrawer()">
            <img src="assets/svg-icons/drawer-toggle-icon.svg" />
        </span>
    </div>
    <div class="py-[10px] bg-table-header px-[15px] flex font-Barlow font-medium leading-[18px] text-secondaryText text-xs">
        <span class="min-w-[355px]">Name</span>
        <span class="min-w-[102.324px]">Updates</span>
        <span class="min-w-[120px]">Date saved</span>
        <span class="min-w-[127.933px]">Surface</span>
        <span class="min-w-full">Objects</span>
    </div>
    @for (group of groups; track group;let index = $index) {
      <ng-container>
        <div [ngClass]="activeIndex == index ? 'bg-[#232B32]':'bg-transparent'">
            <div (click)="rowExpanded(index,group)" [ngClass]="activeIndex == index ? 'bg-[#232B32]':'bg-primaryBg'" class="py-[10px] cursor-pointer flex border-y border-y-solid border-y-custom-border px-[15px] font-Barlow font-medium leading-[18px] text-secondaryText text-xs">
                <div class="min-w-[355px] flex gap-[15px]">
                    <img [src]="activeIndex == index? 'assets/svg-icons/folder-icon-expanded.svg':'assets/svg-icons/folder-icon.svg'" alt="" />
                    <span >{{group.name}}</span>
                </div>
                <span class="min-w-[102.324px]"></span>
                <span class="min-w-[120px]">{{group.created_at | dateFormat}}</span>
                <span class="min-w-[127.933px]">{{group.surface_area.toFixed(3)}}kmÂ²</span>
                <div class="flex gap-[15px] min-w-[85px] justify-between items-center">
                    <span class="text-secondary-heiglight">{{group.total_objects}}</span>
                    <span class="w-[16px] h-[16px] flex cursor-pointer" (click)="$event.stopPropagation();setClass()" [matMenuTriggerFor]="menu">
                        <img src="assets/svg-icons/nav-menu-icon.svg" />
                    </span>
                    <mat-menu class="bg-secondaryBg" panelClass="custom-panel-class"  #menu="matMenu" id="site" overlayPanelClass="custom-backdrop-class">
                        <div class="inline-flex p-[15px] font-Barlow flex-col items-start gap-[15px]">
                            <span class="text-secondary-heiglight text-xs font-bold leading-[18px]">Notifications</span>
                            <div class="rounded-[25px] bg-primaryBg flex items-center justify-between">
                                <button (click)="setNotifications(true,group)"
                                    class="text-xs leading-[18px] py-[9px] font-semibold my-[7px] mr-[10px] ml-[7px] rounded-[19px] px-[20px]"
                                    [ngClass]="group?.notification ?'text-[#453303] bg-yellow':'text-secondary-heiglight'">On
                                   </button>
                                <button (click)="setNotifications(false,group)"
                                    class="text-xs leading-[18px] py-[9px] font-semibold my-[7px] mr-[7px] rounded-[19px] px-[20px] "
                                    [ngClass]="!group?.notification?'text-[#453303] bg-yellow':'text-secondary-heiglight'">Off</button>
                            </div>
                            <span class="text-yellow text-xs font-bold leading-[18px] cursor-pointer" (click)="addGroup('addSubgroup',group)">Add subgroup</span>
                            <span class="text-yellow text-xs font-bold leading-[18px] cursor-pointer" (click)="renameGroup('rename',group)">Rename</span>
                            <span class="text-yellow text-xs font-bold leading-[18px] cursor-pointer" (click)="deleteGroup('delete',group)">Delete</span>
                        </div>
                    </mat-menu>
                </div>
            </div>
            <div 
      *ngIf="activeIndex === index" 
      class="overflow-hidden transition-all duration-300 ease-in-out pl-[15px]" 
      [ngClass]="activeIndex === index ? 'max-h-[500px] opacity-100' : 'max-h-0 opacity-0'"
    >
    @for (nestedGroup of nestedGroupsData?.subgroups;track nestedGroup  ;let i = $index){
        <ng-container>
            <app-groups-list 
        [group]="nestedGroup" 
        (selectedGroup)="selectedGroupEvent($event)" 
        [index]="i"
        [type]="'Groups'"
        [padding]="'15px'"
      ></app-groups-list>
        </ng-container>
    }
      
    </div>
        </div>
       
      </ng-container>
    }
  </div>