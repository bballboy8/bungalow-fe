<div class="flex flex-col gap-3">
    <div class="flex items-center justify-between h-[48px] bg-secondaryBg p-3">
        <span class="text-xs leading-[18px] font-semibold text-secondary-heiglight">Library</span>
        <span class="w-[16px] h-[14px] cursor-pointer" (click)="closeLibraryDrawer()">
            <img src="assets/svg-icons/drawer-toggle-icon.svg" />
        </span>
    </div>


    <div class="mx-[15px] gap-3 grid-cols-4 flex font-Barlow">

        <div class="w-[190px] flex flex-col gap-3 my-3 p-3 bg-secondaryBg rounded-[5px] font-Barlow">
            <span class="text-xs leading-[18px] font-semibold text-secondary-heiglight">Selection area</span>
            <span class="text-sm font-medium leading-[18px] text-secondaryText font-Barlow">8,080,464.3Â km2</span>
        </div>
        <div class="w-[190px] flex flex-col gap-3 my-3 p-3 bg-secondaryBg rounded-[5px]">
            <span class="text-xs leading-[18px] font-semibold text-secondary-heiglight">Name</span>
            <div class="text-sm flex justify-between font-medium leading-[18px] text-secondaryText">
                <span class="text-sm font-medium leading-[18px] text-secondaryText">Untitled area</span>
                <button mat-button
                    class="cursor-pointer hover:!bg-secondaryBg !h-[18px] !text-yellow font-semibold text-xs leading-[18px]"
                    [matMenuTriggerFor]="menu">Save</button>
            </div>
            <mat-menu class="bg-primaryBg" #menu="matMenu" id="library">
                <div class="p-[15px] flex flex-col gap-[10px]">
                    <div class="flex flex-col gap-3" (click)="$event.stopPropagation()">
                        <span class="text-secondary-heiglight font-semibold text-xs leading-[18px]">Save
                            selection</span>
                        <mat-form-field id="library" appearance="outline" class="!w-[320px]"
                            (click)="$event.stopPropagation()">
                            <mat-label>Name</mat-label>
                            <input matInput placeholder="Placeholder">
                        </mat-form-field>
                    </div>
                    <span (click)="$event.stopPropagation()"><mat-checkbox class="example-margin"
                            [(ngModel)]="checked">Notify me of new updates</mat-checkbox></span>
                    <button
                        class="flex justify-center text-[#453303] items-center text-center w-full h-[38px] py-[10px] bg-yellow rounded-[5px]">Save</button>
                    <button
                        class="flex justify-center text-[##ABB7C0] items-center text-center w-full h-[38px] py-[10px] bg-secondary-heiglight rounded-[5px]">Cancel</button>
                </div>
            </mat-menu>
        </div>
        <div class="w-[190px] flex flex-col gap-3 my-3 p-3 bg-secondaryBg rounded-[5px]">
            <span class="text-xs leading-[18px] font-semibold text-secondary-heiglight">Groups</span>
            <div class="text-sm flex justify-between font-medium leading-[18px] text-secondaryText">
                <span class="text-sm font-medium leading-[18px] text-secondaryText">Not assigned</span>
                <span class="cursor-pointer text-yellow font-semibold text-xs leading-[18px]"
                    [matMenuTriggerFor]="assign">Assign</span>
            </div>
        </div>
        <div class="w-[190px] flex flex-col gap-3 p-3 my-3 bg-secondaryBg rounded-[5px]">
            <span class="text-xs leading-[18px] font-semibold text-secondary-heiglight">Objects</span>
            <span class="text-sm font-medium leading-[18px] text-secondaryText">8660</span>
        </div>

    </div>

    <div class="mx-[15px] bg-secondaryBg rounded-[5px] font-Barlow">
        <div class="mx-[15px] gap-[5px] flex font-Barlow">
            <div *ngFor="let info of statsInfo"
                class="w-[182px] flex flex-col p-[10px] gap-1 my-3 bg-primaryBg rounded-[5px] text-center items-center justify-center">
                <span class="text-xs leading-[18px] font-semibold text-secondary-heiglight">
                    {{ info.label }}
                </span>
                <span class="text-sm font-semibold leading-[18px]" [ngClass]="info?.color">
                    {{ info.value }}
                </span>
            </div>
        </div>

        <div class="mx-[15px] flex font-Barlow">
            <div *ngFor="let level of fillLevels;let isLast = last"
                class="w-[182px] flex p-[10px] flex-col gap-1 my-3 text-center items-center justify-center font-Barlow"
                [ngClass]="{ 'border-r-[2px] border-[#2D343D]': !isLast }">

                <div class="custom-progress-container">
                    <div class="custom-progress-bar" [ngStyle]="{ height: level.value + '%', background: '#ABB7C0' }">
                    </div>
                </div>
                <span class="text-xs leading-[18px] font-semibold text-secondaryText">{{ level.duration }}</span>
                <span class="flex text-sm font-semibold leading-[18px]"
                    [ngStyle]="{ color: level.trend === 'up' ?'#22F57A':'#F52222' }">
                    {{ level.value }}%
                    <img [src]="level.trend === 'up'?'assets/svg-icons/up-icon.svg' :'assets/svg-icons/down-icon.svg'"
                        alt="up_icon" class="ml-1" />
                </span>
            </div>
        </div>
    </div>

    <div class="bg-secondaryBg w-full" id="custom_table">
        <div class="flex m-[20px] justify-between items-center">
            <!-- <p class="text-xs font-semibold leading-[18px] text-secondaryText">Image library 11</p> -->
            <div class="rounded-[25px] bg-primaryBg flex items-center justify-between">
                <button (click)="selectPreviewMethod('table')"
                    class="text-xs leading-[18px] py-[9px] font-semibold my-[7px] mr-[10px] ml-[7px] rounded-[19px] px-[20px]"
                    [ngClass]="viewType ==='table'?'text-[#453303] bg-yellow':'text-secondary-heiglight'">Image library
                    11</button>
                <button (click)="selectPreviewMethod('browse')"
                    class="text-xs leading-[18px] py-[9px] font-semibold my-[7px] mr-[7px] rounded-[19px] px-[20px] "
                    [ngClass]="viewType ==='browse'?'text-[#453303] bg-yellow':'text-secondary-heiglight'">Browse</button>
            </div>
            <div class="Menu">
                <div class="flex">
                    <div class="rounded-[25px] bg-primaryBg flex items-center justify-between">
                        <button
                            class="text-xs leading-[18px] py-[9px] font-semibold my-[6px] mr-[10px] ml-[8px] rounded-[19px] px-[20px] text-secondaryText bg-secondaryBg">UTC</button>
                        <button
                            class="text-xs leading-[18px] py-[9px] font-semibold my-[6px] mr-[7px] rounded-[19px] px-[20px] text-secondary-heiglight">Local
                            time</button>
                    </div>
                    <button class="py-[9px] px-[20px] my-0 ml-[8px] rounded-[19px] bg-primaryBg"><img
                            src="assets/svg-icons/filter-icon.svg" alt=""></button>
                    <button (click)="calendarEventsOpen()" class="py-[9px] px-[20px] my-0 mx-[8px] rounded-[19px] " 
                    [ngClass]="isEventsOpened ?'text-[#453303] bg-yellow':'bg-primaryBg'">
                    @if (isEventsOpened) {
                        <img src="assets/svg-icons/calendar-icon-black.svg" alt="">
                    } @else {
                        <img src="assets/svg-icons/calendar-icon.svg" alt="">
                    } </button>
                </div>
            </div>
        </div>

        @if (viewType=='browse') {
        <div class="w-[820px] overflow-auto h-[32vh]">
            <div class="flex flex-start all_wrap flex-wrap ml-[20px]">
                @for (item of browseItem; track item) {
                    <div class="bg-secondaryBg rounded-[5px] font-Barlow single_browse w-[182px]">
                        <div class="flex flex-col">
                            <div class="relative group cursor-pointer" (click)="openImagePreviewDialog(item)">
                                <img src="assets/svg-icons/map-browse-satellite.svg" alt="Map" class="w-full h-auto">
                                <div class="absolute inset-0 bg-black/70 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                    <img src="assets/svg-icons/magnifying-icon.svg" alt="" srcset="">
                                </div>
                            </div>

                            <div class="flex justify-between">
                                <span class="text-secondaryText text-xs font-bold">{{item?.date}}</span>
                                <span class="text-secondaryText text-xs font-bold">{{item?.time}}</span>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
        }@else {
        <div class="w-[820px] overflow-auto h-[34vh]">
            <table mat-table [dataSource]="dataSource" multiTemplateDataRows
                class="font-Barlow mat-elevation-z8 bg-primaryBg w-full border border-secondaryText rounded-lg">
                <ng-container matColumnDef="selectDate">
                    <th mat-header-cell *matHeaderCellDef class="w-[202px] p-[10px] text-secondaryText font-semibold">
                        <mat-checkbox (change)="$event ? toggleAllRows() : null"
                            [checked]="selection.hasValue() && isAllSelected()"
                            [indeterminate]="selection.hasValue() && !isAllSelected()" [aria-label]="'Select All'">
                        </mat-checkbox>
                        Date
                    </th>
                    <td mat-cell *matCellDef="let row" class="w-[202px] p-[10px] flex items-center">
                        <mat-checkbox (click)="$event.stopPropagation()"
                            (change)="$event ? selection.toggle(row) : null" [checked]="selection.isSelected(row)"
                            [aria-label]="'Select Row'">
                        </mat-checkbox>
                        <span class="text-secondaryText font-Barlow">{{ row.Date + ' ' + row.time }}</span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="Sensor">
                    <th mat-header-cell *matHeaderCellDef class="w-[100px] p-[10px] text-secondaryText font-semibold">
                        Sensor</th>
                    <td mat-cell *matCellDef="let row" class="w-[100px] p-[10px] text-secondaryText">{{ row.Sensor }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="Vendor">
                    <th mat-header-cell *matHeaderCellDef class="w-[100px] p-[10px] text-secondaryText font-semibold">
                        Vendor</th>
                    <td mat-cell *matCellDef="let row" class="w-[100px] p-[10px] text-secondaryText">{{ row.Vendor }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="Cover">
                    <th mat-header-cell *matHeaderCellDef class="w-[60px] p-[10px] text-secondaryText font-semibold">
                        Cover</th>
                    <td mat-cell *matCellDef="let row" class="w-[60px] p-[10px] text-secondaryText">{{ row.Cover }}</td>
                </ng-container>

                <ng-container matColumnDef="Resolution">
                    <th mat-header-cell *matHeaderCellDef class="w-[90px] p-[10px] text-secondaryText font-semibold">
                        Resolution</th>
                    <td mat-cell *matCellDef="let row" class="w-[90px] p-[10px] text-secondaryText">{{ row.Resolution }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="type">
                    <th mat-header-cell *matHeaderCellDef class="w-[60px] p-[10px] text-secondaryText font-semibold">
                        Type</th>
                    <td mat-cell *matCellDef="let row" class="w-[60px] p-[10px] text-secondaryText">{{ row.type }}</td>
                </ng-container>

                <ng-container matColumnDef="Id">
                    <th mat-header-cell *matHeaderCellDef class="w-[100px] p-[10px] text-secondaryText font-semibold">ID
                    </th>
                    <td mat-cell *matCellDef="let row" class="w-[150px] p-[10px] text-secondaryText">
                        <div class="flex">
                            <span class="w-[100px] truncate">{{ row.Id }}</span>
                            <span><img src="assets/svg-icons/marker-icon.svg" alt=""></span>
                        </div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="expand">
                    <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
                    <td mat-cell *matCellDef="let element">
                        <button mat-icon-button aria-label="expand row"
                            (click)="(expandedElement = expandedElement === element ? null : element); $event.stopPropagation()">
                            <mat-icon *ngIf="expandedElement !== element">keyboard_arrow_down</mat-icon>
                            <mat-icon *ngIf="expandedElement === element">keyboard_arrow_up</mat-icon>
                        </button>
                    </td>
                </ng-container>

                <ng-container matColumnDef="expandedDetail">
                    <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length">
                        <div class="example-element-detail"
                            [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                            <div class="p-7 flex">
                                <div class="image">
                                    <img src="./../../../assets/svg-icons/map-sattelite.svg" alt="">
                                </div>
                                <div class="detail px-3">
                                    <div class="flex py-2"> <span class="text-secondary-heiglight font-semibold">Name:
                                        </span> <span class="text-secondaryText">{{element.Id}}</span> </div>
                                    <div class="flex py-2"> <span class="text-secondary-heiglight font-semibold">Date:
                                        </span> <span class="text-secondaryText">{{element.Date}}</span> </div>
                                    <div class="flex py-2"> <span class="text-secondary-heiglight font-semibold">Time:
                                        </span> <span class="text-secondaryText">{{element.time}}</span> </div>
                                    <div class="flex py-2"> <span class="text-secondary-heiglight font-semibold">Cloud
                                            cover: </span> <span class="text-secondaryText">{{element.Cover}}</span>
                                    </div>
                                    <div class="flex py-2"> <span
                                            class="text-secondary-heiglight font-semibold">Resolution: </span> <span
                                            class="text-secondaryText">{{element.Resolution}}</span> </div>
                                    <div class="flex py-2"> <span class="text-secondary-heiglight font-semibold">Area:
                                        </span> <span class="text-secondaryText">{{element.area}}</span> </div>
                                    <div class="flex py-2"> <span class="text-secondary-heiglight font-semibold">Geo
                                            referenced: </span> <span
                                            class="text-secondaryText">{{element.geo_reference?'True':'False'}}</span>
                                    </div>
                                    <div class="flex py-2"> <span class="text-secondary-heiglight font-semibold">Sun
                                            elevation: </span> <span
                                            class="text-secondaryText">{{element.sun_elevation}}</span> </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-secondaryBg"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"
                    class="hover:bg-secondaryHighlight cursor-pointer"
                    (click)="expandedElement = expandedElement === row ? null : row">
                </tr>

                <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
            </table>
        </div>
        }

    </div>
    <mat-menu class="bg-primaryBg" #assign="matMenu" id="assign">
        <div class="p-[15px] flex flex-col gap-[10px]">
            <div class="flex flex-col gap-3" (click)="$event.stopPropagation()">
                <span class="text-secondary-heiglight font-semibold text-xs leading-[18px]">Assign to group</span>
                <mat-form-field id="library" appearance="outline" class="!w-[320px]" (click)="$event.stopPropagation()">
                    <mat-label>Search groups</mat-label>
                    <input matInput placeholder="Search ...">
                    <img src="assets/svg-icons/search-icon.svg" alt="Search" />
                </mat-form-field>
            </div>
            <mat-list>
                <ng-container *ngFor="let group of groups">
                    <ng-template [ngTemplateOutlet]="renderGroup"
                        [ngTemplateOutletContext]="{ $implicit: group }"></ng-template>
                </ng-container>
            </mat-list>
            <span (click)="$event.stopPropagation()"><mat-checkbox class="example-margin" [(ngModel)]="checked">Notify
                    me of new updates</mat-checkbox></span>
            <button
                class="flex justify-center text-[#453303] items-center text-center w-full h-[38px] py-[10px] bg-yellow rounded-[5px]">Save</button>
            <button
                class="flex justify-center text-[##ABB7C0] items-center text-center w-full h-[38px] py-[10px] bg-secondary-heiglight rounded-[5px]">Cancel</button>
        </div>
    </mat-menu>
</div>