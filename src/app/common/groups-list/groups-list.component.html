@if(type === 'Groups'){
    <div class="font-Barlow" >
        <!-- Group Header -->
            <!-- @if (isExpanded) {
                <span class="w-[14px] h-[12px]">
                    <img src="assets/svg-icons/folder-icon-expanded.svg" alt="Search" class="w-[14px]" />
                </span>
            } @else {
                <span class="!w-[14px] h-[12px]">
                    <img src="assets/svg-icons/folder-icon.svg" alt="Search" class="w-[14px]" />
                </span>
            } -->
          <div (click)="toggle(group)" class="py-[10px] cursor-pointer flex border-y border-y-solid border-y-custom-border font-Barlow font-medium leading-[18px] text-secondaryText text-xs">
            <div class="min-w-[355px] flex gap-[15px]" [ngStyle]="{ 'padding-left': padding + 'px' }">
                <img [src]="activeIndex?.id == group?.id ? 'assets/svg-icons/folder-icon-expanded.svg':'assets/svg-icons/folder-icon.svg'" alt="" />
                <span >{{group.name}}</span>
            </div>
            <span class="min-w-[102.324px]"></span>
            <span class="min-w-[120px]">{{group.created_at | dateFormat}}</span>
            <span class="min-w-[127.933px]">{{roundOff(group.surface_area)}}km²</span>
            <div class="flex gap-[15px] min-w-[85px] justify-between items-center">
                <span class="text-secondary-heiglight">{{group.total_objects}}</span>
                <span class="w-[16px] h-[16px] flex cursor-pointer" (click)="$event.stopPropagation();setClass()" [matMenuTriggerFor]="menu">
                    <img src="assets/svg-icons/nav-menu-icon.svg" />
                </span>
                <mat-menu class="bg-secondaryBg" #menu="matMenu" id="site">
                    <div class="inline-flex p-[15px] font-Barlow flex-col items-start gap-[15px]">
                        <span class="text-secondary-heiglight text-xs font-bold leading-[18px]">Notifications</span>
                        <div class="rounded-[25px] bg-primaryBg flex items-center justify-between">
                            <button (click)="setNotifications(true,group)"
                                class="text-xs leading-[18px] py-[9px] font-semibold my-[7px] mr-[10px] ml-[7px] rounded-[19px] px-[20px]"
                                [ngClass]="group?.notification ?'text-[#453303] bg-yellow':'text-secondary-heiglight'">On
                               </button>
                            <button (click)="setNotifications(false,group)"
                                class="text-xs leading-[18px] py-[9px] font-semibold my-[7px] mr-[7px] rounded-[19px] px-[20px] "
                                [ngClass]="!group?.notification?'text-[#453303] bg-yellow':'text-secondary-heiglight'">Off</button>
                        </div>
                        <span class="text-yellow text-xs font-bold leading-[18px] cursor-pointer" (click)="addGroup('addSubgroup',group)">Add subgroup</span>
                        <span class="text-yellow text-xs font-bold leading-[18px] cursor-pointer" (click)="renameGroup('rename',group)">Rename</span>
                        <span class="text-yellow text-xs font-bold leading-[18px] cursor-pointer" (click)="deleteGroup('delete',group)">Delete</span>
                    </div>
                </mat-menu>
            </div>
        </div>
        
    
        <!-- Subgroups -->
        @if (activeIndex?.id == group?.id){
            @if (group?.sites.length > 0){
                @for (site of group?.sites;track site;let j = $index){
                    <div class="flex flex-col gap-[10px]">
                        <div (click)="getSitesDetail(site)" class="py-[10px] items-center cursor-pointer flex border-y border-y-solid border-y-custom-border px-[15px] font-Barlow font-medium leading-[18px] text-secondaryText text-xs">
                            <div class="min-w-[340px] flex items-center gap-[15px]" [ngStyle]="{ 'padding-left': getPadding(padding) + 'px' }">
                                <img [ngClass]="{'point-site': site?.site_type == 'Point'}" class="h-[25px] w-[25px] object-cover" height="30" width="30" [src]="getSiteType(site?.site_type)" alt="" />
                                <span >{{site.name}}</span>
                            </div>
                            <span class="min-w-[102.324px]"></span>
                            <span class="min-w-[120px]">{{site.date | dateFormat}}</span>
                            <span class="min-w-[127.933px]">{{roundOff(site?.area)}}km²</span>
                            <div class="flex gap-[15px] min-w-[85px] justify-between items-center">
                                <!-- <span class="text-secondary-heiglight">{{site.total_objects}}</span> -->
                                <span class="text-secondary-heiglight">{{site?.count}}</span>
                                <span class="w-[16px] h-[16px] flex cursor-pointer" (click)="$event.stopPropagation();setClass()" [matMenuTriggerFor]="siteMenu">
                                    <img src="assets/svg-icons/nav-menu-icon.svg" />
                                </span>
                                <mat-menu class="bg-secondaryBg" panelClass="custom-panel-class"  #siteMenu="matMenu" id="site" overlayPanelClass="custom-backdrop-class">
                                    <div class="inline-flex p-[15px] font-Barlow flex-col items-start gap-[15px]">
                                        <span class="text-secondary-heiglight text-xs font-bold leading-[18px]">Notifications</span>
                                        <div class="rounded-[25px] bg-primaryBg flex items-center justify-between">
                                            <button (click)="updateSite(true,site)"
                                                class="text-xs leading-[18px] py-[9px] font-semibold my-[7px] mr-[10px] ml-[7px] rounded-[19px] px-[20px]"
                                                [ngClass]="site?.notification ?'text-[#453303] bg-yellow':'text-secondary-heiglight'">On
                                            </button>
                                            <button (click)="updateSite(false,site)"
                                                class="text-xs leading-[18px] py-[9px] font-semibold my-[7px] mr-[7px] rounded-[19px] px-[20px] "
                                                [ngClass]="!site?.notification?'text-[#453303] bg-yellow':'text-secondary-heiglight'">Off</button>
                                        </div>
                                        <!-- <span class="text-yellow text-xs font-bold leading-[18px] cursor-pointer" (click)="addGroup('addSubgroup',group)">Add subgroup</span> -->
                                        <span class="text-yellow text-xs font-bold leading-[18px] cursor-pointer" (click)="renameSite('rename',site)">Rename</span>
                                        <span class="text-yellow text-xs font-bold leading-[18px] cursor-pointer" (click)="deleteSite('delete',site)">Delete</span>
                                    </div>
                                </mat-menu>
                            </div>
                        </div>
                        <div 
                        *ngIf="activeSite === site?.id" 
                        class="overflow-hidden transition-all duration-300 ease-in-out" 
                        [ngClass]="activeSite === site?.id ? 'max-h-[500px] opacity-100' : 'max-h-0 opacity-0'"
                    >
                    <div
                class="flex py-[15px] px-[5px] items-center gap-[15px] self-stretch bg-primaryBg border-b border-b-solid border-custom-border">
                <div class="flex flex-col items-start gap-[15px] flex-0">
                    <!-- <div class="flex py-[5px] px-[5px] items-center gap-[15px] self-stretch">
                        <span class="w-[16px] flex">
                            <img class="object-cover w-[40px] h-[30px]" height="30" width="30"
                                [src]="siteDetail?.site_type =='Polygon'? 'assets/svg-icons/polygon-icon.svg':'assets/svg-icons/rectangle-icon.svg'" />
                        </span>
                        <span class="text-secondaryText w-full text-sm font-medium leading-normal">{{siteDetail?.name}}</span>
                        <span class="w-[16px] h-[16px] flex">
                            <img src="assets/svg-icons/plus-icon.svg" />
                        </span>
                        <span class="w-[16px] h-[16px] flex">
                            <img src="assets/svg-icons/nav-menu-icon.svg" />
                        </span>
                        <div class="w-[16px] h-[16px] flex ">
                            <span class="w-[16px] h-[16px] flex cursor-pointer" >
                                <img src="assets/svg-icons/nav-menu-icon.svg" />
                            </span>
                            <mat-menu class="bg-secondaryBg" #menu="matMenu" id="site">
                                <div class="inline-flex p-[15px] font-Barlow flex-col items-start gap-[15px]">
                                    <span class="text-secondary-heiglight text-xs font-bold leading-[18px]">Notifications</span>
                                    <div class="rounded-[25px] bg-primaryBg flex items-center justify-between">
                                        <button (click)="updateSite(true,siteDetail)"
                                            class="text-xs leading-[18px] py-[9px] font-semibold my-[7px] mr-[10px] ml-[7px] rounded-[19px] px-[20px]"
                                            [ngClass]="siteDetail?.notification ?'text-[#453303] bg-yellow':'text-secondary-heiglight'">On
                                        </button>
                                        <button (click)="updateSite(false,siteDetail)"
                                            class="text-xs leading-[18px] py-[9px] font-semibold my-[7px] mr-[7px] rounded-[19px] px-[20px] "
                                            [ngClass]="!siteDetail?.notification?'text-[#453303] bg-yellow':'text-secondary-heiglight'">Off</button>
                                    </div>
                                    <div id="renameMenu">
                                        <span class="text-yellow text-xs font-bold leading-[18px] cursor-pointer" [matMenuTriggerFor]="rename" (click)="$event.stopPropagation();patchNameValue(siteDetail);setClass()">Rename</span>
                                        <mat-menu class="bg-primaryBg" #rename="matMenu" id="rename">
                                            <div class="p-[15px] flex flex-col gap-[15px]">
                                                <div class="flex flex-col gap-3" (click)="$event.stopPropagation()">
                                                    <span class="text-secondary-heiglight font-semibold text-xs leading-[18px]">Save
                                                        selection</span>
                                                    <mat-form-field id="rename" appearance="outline" class="!w-[320px]"
                                                        (click)="$event.stopPropagation()">
                                                        <mat-label>Rename</mat-label>
                                                        <input [(ngModel)]="name" matInput placeholder="Placeholder">
                                                    </mat-form-field>
                                                </div>
                                            
                                                <button 
                                                    class="flex justify-center text-[#453303] items-center text-center w-full h-[38px] py-[10px] bg-yellow rounded-[5px]" (click)="updateSite('rename',site)">Save</button>
                                                <button
                                                    class="flex justify-center text-[##ABB7C0] items-center text-center w-full h-[38px] py-[10px] bg-secondary-heiglight rounded-[5px]">Cancel</button>
                                            </div>
                                        </mat-menu>
                                    </div>
                                    <div>
                                    <span class="text-yellow text-xs font-bold leading-[18px] cursor-pointer" [matMenuTriggerFor]="delete" (click)="$event.stopPropagation();setClass()">Delete</span>
                                    <mat-menu class="bg-primaryBg" #delete="matMenu" id="delete">
                                        <div class="p-[15px] flex flex-col gap-[15px]">
                                            
                                        <span class="text-secondaryText text-sm font-bold leading-normal">Are you sure you want to remove this item?</span>
                                            <button 
                                                class="flex justify-center text-[#453303] items-center text-center w-full h-[38px] py-[10px] bg-yellow rounded-[5px]" (click)="updateSite('delete',site)">Delete</button>
                                            <button
                                                class="flex justify-center text-[##ABB7C0] items-center text-center w-full h-[38px] py-[10px] bg-secondary-heiglight rounded-[5px]">Cancel</button>
                                        </div>
                                    </mat-menu>
                                    </div>
                                </div>
                            </mat-menu>
                        </div>
                    </div> -->
                    <div class="flex min-w-[775px] items-center gap-[15px] self-stretch">
                        <div
                            class="flex flex-col justify-center items-start px-[8px] py-[15px] self-stretch gap-[5px] rounded-[5px] border border-solid border-custom-border bg-primaryBg">
                            <span class="text-secondary-heiglight text-xs font-bold leading-[18px]">Frequency</span>
                            <span class="text-secondaryText text-xs font-bold leading-normal">{{siteDetail?.frequency}}</span>
                        </div>
                        <div
                            class="flex flex-col justify-center items-start px-[8px] py-[15px] self-stretch gap-[5px] rounded-[5px] border border-solid border-custom-border bg-primaryBg">
                            <span class="text-secondary-heiglight text-xs font-bold leading-[18px]">Most recent</span>
                            <span class="text-secondaryText text-xs font-bold leading-normal">{{siteDetail?.most_recent | dateFormat}}</span>
                        </div>
                        <div
                            class="flex flex-col justify-center items-start px-[8px] py-[15px] self-stretch gap-[5px] rounded-[5px] border border-solid border-custom-border bg-primaryBg">
                            <span class="text-secondary-heiglight text-xs font-bold leading-[18px]">Gap</span>
                            <span class="text-secondaryText text-xs font-bold leading-normal">{{siteDetail?.gap.toFixed(3)}}</span>
                        </div>
                        <div
                            class="flex flex-col justify-center items-start p-[15px] self-stretch gap-[5px] rounded-[5px] border border-solid border-custom-border bg-primaryBg">
                            <span class="text-secondary-heiglight text-xs font-bold leading-[18px]">Most recent</span>
                            <span class="text-yellow text-xs font-bold leading-normal">{{siteDetail?.most_recent | dateFormat}}</span>
                        </div>
                        <div
                            class="flex flex-col justify-center items-start px-[8px] py-[15px] self-stretch gap-[5px] rounded-[5px] border border-solid border-custom-border bg-primaryBg">
                            <span class="text-secondary-heiglight text-xs font-bold leading-[18px]">Most recent clear</span>
                            <span class="text-yellow text-xs font-bold leading-normal">{{siteDetail?.most_recent_clear | dateFormat}}</span>
                        </div>
                        @if (site) {
                            <div
                            class="flex relative flex-col h-[110px] w-[320px] p-[5px] items-center self-stretch gap-[5px] rounded-[5px] border border-solid border-custom-border bg-primaryBg">
                        
                            @if (chartOptions?.series?.length) {
                                <div class="flex felx-col ">
                                    <div class="flex gap-[5px] font-Barlow flex-wrap">
                                        <div class="flex items-center flex-col gap-[5px]">
                                            <span class="w-[15px] h-[15px] bg-[#272F34] rounded-[5px]"></span>
                                            <span class="text-secondaryText text-[10px]">Very low</span>
                                        </div>
                                        <div class="flex items-center flex-col gap-[5px]">
                                            <span class="w-[15px] h-[15px] bg-[#2A2130] rounded-[5px]"></span>
                                            <span class="text-secondaryText text-[10px]">Low</span>
                                        </div>
                                        <div class="flex items-center flex-col gap-[5px]">
                                            <span class="w-[15px] h-[15px] bg-[#122B64] rounded-[5px]"></span>
                                            <span class="text-secondaryText text-[10px]">Medium</span>
                                        </div>
                                        <div class="flex items-center flex-col gap-[5px]">
                                            <span class="w-[15px] h-[15px] bg-[#386118] rounded-[5px]"></span>
                                            <span class="text-secondaryText text-[10px]">High</span>
                                        </div>
                                        <div class="flex items-center flex-col gap-[5px]">
                                            <span class="w-[15px] h-[15px] bg-[#FFC300] rounded-[5px]"></span>
                                            <span class="text-secondaryText text-[10px]">Very high</span>
                                        </div>
                                        <div class="flex items-center flex-col gap-[5px]">
                                            <span class="w-[15px] h-[15px] bg-[#C70039] rounded-[5px]"></span>
                                            <span class="text-secondaryText text-xs">Very extreme</span>
                                        </div>
                                    </div>
                                <div id="chart" class="absolute !left-[0px] mt-[8px]">
                                    <apx-chart
                                    [series]="chartOptions.series"
                                    [chart]="chartOptions.chart"
                                    [plotOptions]="chartOptions.plotOptions"
                                    [dataLabels]="chartOptions.dataLabels"
                                    [xaxis]="chartOptions.xaxis"
                                    [yaxis]="chartOptions.yaxis"
                                    [grid]="chartOptions.grid"
                                    [title]="chartOptions.title"
                                    [legend]="chartOptions.legend">
                                  </apx-chart>
                                  
    
                                  </div>
                                </div>
                            } @else {
                                <span class="text-secondary-heiglight text-xs font-bold leading-[18px]">No heatmap data found</span>
                            }
                        </div>
                        }
                    </div>
                </div>
            </div>
                        </div>
                    </div>    
                }
            }
            <div class="" >
            @for (subgroup of group.subgroups; track subgroup;let i = $index) {
            <div class="overflow-hidden transition-all duration-300 ease-in-out">
            <app-groups-list [group]="subgroup" [index]="i" [type]="'Groups'" [padding]="'30'"></app-groups-list>
            </div>
             }
        </div>
    }
      </div>
} @else{
    <div class="font-Barlow" >
        <!-- Group Header -->
        <div class="group-header flex gap-[15px] text-sm font-medium text-secondaryText p-[15px] border-y border-y-solid border-y-custom-border" [ngClass]="isExpanded? 'bg-[#232B32] ':'bg-primaryBg'" (click)="toggle(group)">
            @if (isExpanded) {
                <span class="w-[14px] h-[12px]">
                    <img src="assets/svg-icons/folder-icon-expanded.svg" alt="Search" class="w-[14px]" />
                </span>
            } @else {
                <span class="!w-[14px] h-[12px]">
                    <img src="assets/svg-icons/folder-icon.svg" alt="Search" class="w-[14px]" />
                </span>
            }
          {{ group.name }}
        </div>
    
        <!-- Subgroups -->
        @if (isExpanded){<div class="subgroup" [ngClass]="isExpanded? 'bg-[#232B32] ':'bg-primaryBg'">
            @for (subgroup of group.subgroups; track subgroup) {
            <app-groups-list [group]="subgroup" [backgroundColor]="backgroundColor"></app-groups-list>
             }
        </div>
    }
      </div>
}